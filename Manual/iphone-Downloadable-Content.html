<!DOCTYPE html><html lang="en" class="no-js">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<script>var offline=(location.href.indexOf('docs.unity3d.com')==-1)?true:false;if(!offline){(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);  })(window,document,'script','dataLayer','GTM-5V25JL6');}</script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unity - Manual: Preparing your application for In-App Purchases (IAP)</title>
<meta property="og:image" content="https://unity3d.com/files/images/ogimg.jpg">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFilesManual/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFilesManual/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFilesManual/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFilesManual/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFilesManual/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFilesManual/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFilesManual/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFilesManual/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="https://docs.unity3d.com/StaticFilesConfig/UnityVersionsInfo.js"></script><script type="text/javascript" src="../StaticFilesManual/js/jquery.js?ts=1576442311"></script><script type="text/javascript" src="../StaticFilesManual/js/core.js?ts=1576442311"></script><script type="text/javascript" src="docdata/toc.js?ts=1576442311"></script><script type="text/javascript" src="docdata/global_toc.js?ts=1576442311"></script><link rel="stylesheet" type="text/css" href="../StaticFilesManual/css/core.css?ts=1576442311">
<link rel="stylesheet" href="../StaticFilesManual/js/feedback/five-star-rating-master/css/rating.min.css">
<link rel="stylesheet" href="../StaticFilesManual/css/prism.css">
<script src="../StaticFilesManual/js/prism.js"></script><script src="../StaticFilesManual/js/feedback/five-star-rating-master/js/src/rating.js"></script><script src="../StaticFilesManual/js/jquery.sidebar.min.js"></script><link rel="stylesheet" href="../StaticFilesManual/css/mobileoptimisation.css">
<script src="../StaticFilesManual/js/mobileoptimisation.js"></script>
</head>
<body>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div id="DocsAnalyticsData" data-area="PlatformSpecific" data-pagetype="normal"></div>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="https://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul>
<li><a href="../Manual/index.html" class="selected">Manual</a></li>
<li><a href="../ScriptReference/index.html">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">unity3d.com</a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="toggle version-number" id="VersionNumber" data-target=".otherversionscontent">
                                Version: <b>2019.2</b><div class="otherversionscontent" id="OtherVersionsContent" style="display: none;">
<ul id="OtherVersionsContentUl"></ul>
<div id="otherVersionsLegend"><ul>
<li>
<div id="supportedColour" class="legendBox"></div>Supported</li>
<li>
<div id="notFoundColour" class="legendBox"></div>Legacy</li>
</ul></div>
</div>
<div id="VersionSwitcherArrow" class="arrow versionSwitcherArrow"></div>
</div>
<div class="lang-switcher"><div class="current toggle" data-target=".lang-list">
<div class="lbl">Language
:                <span class="b">English</span>
</div>
<div class="arrow"></div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/iphone-Downloadable-Content.html">English</a></li>
<li><a href="/ja/current/Manual/iphone-Downloadable-Content.html">日本語</a></li>
<li><a href="/es/current/Manual/iphone-Downloadable-Content.html">Español</a></li>
<li><a href="/kr/current/Manual/iphone-Downloadable-Content.html">한국어</a></li>
<li><a href="/ru/current/Manual/iphone-Downloadable-Content.html">Русский</a></li>
</ul></div>
</div></div>
</div></div>
<div class="mobileLogo"><a href="https://docs.unity3d.com"></a></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc" id="customScrollbar">
<h2>Unity Manual</h2>
<div class="search-form sidebar-search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" id="mobileSearchBtn" class="submit" value="Search">
</form></div>
<div class="toggle version-number sidebar-version-switcher" id="VersionNumber" data-target=".otherversionscontent"><form id="otherVersionsContentMobileForm"><div class="ui-field-contain">
<label for="select-native-4">Version: 2019.2</label><select name="select-native-4" id="versionsSelectMobile"><option>Select a different version</option>
<optgroup id="versionsWithThisPageMobile" label="Versions with this page"></optgroup>
<optgroup id="versionsWithoutThisPageMobile" label="Versions without this page"></optgroup></select>
</div></form></div>
<div class="lang-switcher"><div class="current toggle" data-target=".lang-list">
<div class="lbl">Language
:                <span class="b">English</span>
</div>
<div class="arrow"></div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/iphone-Downloadable-Content.html">English</a></li>
<li><a href="/ja/current/Manual/iphone-Downloadable-Content.html">日本語</a></li>
<li><a href="/es/current/Manual/iphone-Downloadable-Content.html">Español</a></li>
<li><a href="/kr/current/Manual/iphone-Downloadable-Content.html">한국어</a></li>
<li><a href="/ru/current/Manual/iphone-Downloadable-Content.html">Русский</a></li>
</ul></div>
</div></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap"><div class="content-block">
<div class="darkCover"></div>
<div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual (2019.2)</a></li>
<li><a href="PlatformSpecific.html">Platform-specific</a></li>
<li><a href="iphone.html">iOS</a></li>
<li>iOS Advanced Topics</li>
<li>Preparing your application for In-App Purchases (IAP)</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="PluginsForIOS.html"></a></span><div class="tip">Building Plugins for iOS</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="iosCustomWWWRequest.html"></a></span><div class="tip">Customising WWW requests on iOS</div>
</div>
</div></div>
<div class="scrollToFeedback"><a id="scrollToFeedback">Leave feedback</a></div>
<h1>Preparing your application for In-App Purchases (IAP)</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>This chapter does <strong>not</strong> describe how to integrate your game with Apple’s <em>StoreKit</em> API. It is assumed that you already have integration with StoreKit via a <a href="Plugins.html">native code plugin</a>.</p>

<p>The Apple StoreKit documentation defines four kinds of products that can be sold via the <em>In-App Purchase</em> process: </p>

<ul>
<li>Content</li>
<li>Functionality</li>
<li>Services</li>
<li>Subscriptions</li>
</ul>

<p>This chapter covers the first case only and focuses mainly on the downloadable content concept. <a href="../ScriptReference/AssetBundle.html">AssetBundles</a> are recommended for implementing downloadable content in Unity and both the creation and runtime usage of AssetBundles will be covered here.</p>

<h2>Exporting your assets for use on iOS</h2>

<p>It is sometimes useful to maintain separate projects for your main application and the downloadable AssetBundles that it will use. However, you should note that all <em>scripts</em> referenced by objects in the AssetBundle must be present in the main game executable. The project you use to create the AssetBundle must have <span class="tooltip"><strong>iOS</strong><span class="tooltiptext">Apple’s mobile operating system. <a href="iphone.html">More info</a><br/><span class="tooltipGlossaryLink">See in <a href="Glossary.html#iOS">Glossary</a></span></span></span> as the selected build target since the content of AssetBundle files is not compatible between <strong>iOS</strong> and other platforms.</p>

<p>AssetBundles are created using editor <span class="tooltip"><strong>scripts</strong><span class="tooltiptext">A piece of code that allows you to create your own Components, trigger game events, modify Component properties over time and respond to user input in any way you like. <a href="CreatingAndUsingScripts.html">More info</a><br/><span class="tooltipGlossaryLink">See in <a href="Glossary.html#Scripts">Glossary</a></span></span></span> - a simple example is given below:</p>

<pre><code>using UnityEngine;
using UnityEditor;

public class ExportBundle : MonoBehaviour {
    [MenuItem (&quot;Assets/Build AssetBundle From Selection - Track dependencies&quot;)]
    static void DoExport() {
        string str = EditorUtility.SaveFilePanel(&quot;Save Bundle...&quot;, Application.dataPath, Selection.activeObject.name, &quot;assetbundle&quot;);
        if (str.Length != 0) {
            BuildPipeline.BuildAssetBundle(Selection.activeObject, Selection.objects, str, BuildAssetBundleOptions.CompleteAssets, BuildTarget.iPhone);
        }
    }
}
</code></pre>

<p>You should save this code in a file called <em>ExportBundle</em> and place it inside a folder called <em>Editor</em> (you can just create this if it isn’t already present in the project). The script will add a menu item entitled <em>Build AssetBundle From Selection - Track dependencies</em> on the <em>Assets</em> menu in the editor.</p>

<p>The content you want to include in the bundle should be prepared in the form of prefabs. Select a prefab in the Project view and then select <em>Assets &gt; Build AssetBundle From Selection - Track dependencies</em> (i.e. the menu item added by the ExportBundle script). This command will bring up a save dialog where you can choose the name and location of your AssetBundle file.</p>

<h2>Downloading your assets on iOS</h2>

<p>
<strong>Note:</strong> Apple may change the folder locations where you are permitted to write data. Always check the latest Apple documentation to be sure your application will be compliant. The following advice was correct as of early 2018.</p>

<p>AssetBundles can be downloaded using the <a href="../ScriptReference/WWW.html">WWW class</a> and once transfer is complete, the enclosed assets can be accessed. The recommended way to download an AssetBundle is to use <a href="../ScriptReference/WWW.LoadFromCacheOrDownload.html">LoadFromCacheOrDownload</a> as shown in the following sample:</p>

<pre><code>IEnumerator GetAssetBundle() {
    WWW download;
    string url = &quot;http://somehost/somepath/someassetbundle.assetbundle&quot;;

    while (!Caching.ready)
        yield return null;

    download = WWW.LoadFromCacheOrDownload(url, 0);

    yield return download;

    AssetBundle assetBundle = download.assetBundle;
    if (assetBundle != null) {
        // Alternatively you can also load an asset by name (assetBundle.Load(&quot;my asset name&quot;))
        Object go = assetBundle.mainAsset;
            
        if (go != null)
            Instantiate(go);
        else
            Debug.Log(&quot;Couldn't load resource&quot;);    
    } else {
        Debug.Log(&quot;Couldn't load resource&quot;);    
    }
}
</code></pre>

<p>The downloaded asset bundle files are stored in the <em>Library</em> folder of the iOS application sandbox and have the <em>No Backup</em> flag set on them. This means the OS won’t delete these files accidentally and these files won’t be backed up to iCloud.</p>

<p>If you need to choose exactly where the AssetBundle file is stored, you can use a standard WWW download (i.e. just use the constructor instead of LoadFromCacheOrDownload) and then save the downloaded data on disk using the .NET file API. You can save required files to the <a href="../ScriptReference/Application-temporaryCachePath.html">Application.temporaryCachePath</a> folder (stored in <em>Library/Caches</em> which is regularly “cleaned out” by the OS) or the <a href="../ScriptReference/Application-persistentDataPath.html">Application.persistentDataPath</a> folder (stored in <em>Documents</em> which is not cleaned out by the OS). You should set the <em>No Backup</em> flag on these files with <a href="../ScriptReference/iOS.Device.SetNoBackupFlag.html">iOS.Device.SetNoBackupFlag</a> to prevent them being backed up to iCloud.</p>

<p>
<strong>Note:</strong> If you don’t set the <em>No Backup</em> flag, your app may be rejected when you submit it to the App Store.</p>

<p>You can access saved files by creating a WWW object with a URL in the form <code>file:///pathtoyourapplication/Library/savedassetbundle.assetbundle</code>:-</p>

<pre><code>string cachedAssetBundle = Application.temporaryCachePath + &quot;/savedassetbundle.assetbundle&quot;; 
System.IO.FileStream cache = new System.IO.FileStream(cachedAssetBundle, System.IO.FileMode.Create);
cache.Write(download.bytes, 0, download.bytes.Length);
cache.Close();

iOS.Device.SetNoBackupFlag(cachedAssetBundle);

Debug.Log(&quot;Cache saved: &quot; + cachedAssetBundle);
</code></pre>

<p>
<strong>Note:</strong> You can test the reading of stored files in the Documents folder if you enable <em>file sharing</em> (setting <code>UIFileSharingEnabled</code> to true in your <code>Info.plist</code> allows you to access the <em>Documents</em> folder from iTunes). Note that the contents of the Documents folder are cached to iCloud, so you should not use this location to store AssetBundles in the final build to be shipped. See <a href="http://developer.apple.com/library/ios/documentation/FileManagement/Conceptual/FileSystemProgrammingGUide/FileSystemOverview/FileSystemOverview.html">File System Basics</a> in the Apple iOS documentation for further details.</p>

<hr>

<ul>
<li><span class="page-edit">2018–06–14 Page amended
</span></li>
</ul>
<div class="feedbackbox" id="feedbackbox">
<div id="rating"><p>Did you find this page useful? Please give it a rating:<br><div id="ratecontent" class="c-rating"></div>
</p></div>
<div id="ratingThanks" style="display:none"><p>Thanks for rating this page!</p></div>
<div id="problem"><p><a name="problem">Report a problem on this page</a></p></div>
<div id="problemType" style="display:none"><p>What kind of problem would you like to report?<ul type="problems">
<li><a name="needcode" id="problemneedcode">This page needs code samples</a></li>
<li><a name="code" id="problemcode">Code samples do not work</a></li>
<li><a name="missing" id="problemmissing">Information is missing</a></li>
<li><a name="incorrect" id="problemincorrect">Information is incorrect</a></li>
<li><a name="unclear" id="problemunclear">Information is unclear or confusing</a></li>
<li><a name="language" id="problemlanguage">There is a spelling/grammar error on this page</a></li>
<li><a name="other" id="problemother">Something else</a></li>
</ul>
<p><known_issues><p>Is something described here not working as you expect it to? It might be a <b>Known Issue</b>. Please check with the Issue Tracker at <a href="https://issuetracker.unity3d.com">issuetracker.unity3d.com</a>.</p></known_issues></p>
</p></div>
<div id="problemThanks" style="display:none"><p>Thanks for letting us know! This page has been marked for review based on your feedback.<br><br>If you have time, you can provide more information to help us fix the problem faster.<br><br><a id="problemThanksMoreInfoButton">Provide more information</a><br>
</p></div>
<div id="problemMoreInfo" style="display:none">
<p id="problemNeedCodeForm" style="display:none">You've told us this page needs code samples. If you'd like to help us further, you could provide a code sample, or tell us about what kind of code sample you'd like to see:</p>
<p id="problemCodeForm" style="display:none">You've told us there are code samples on this page which don't work. If you know how to fix it, or have something better we could use instead, please let us know:</p>
<p id="problemMissingForm" style="display:none">You've told us there is information missing from this page. Please tell us more about what's missing:</p>
<p id="problemIncorrectForm" style="display:none">You've told us there is incorrect information on this page. If you know what we should change to make it correct, please tell us:</p>
<p id="problemUnclearForm" style="display:none">You've told us this page has unclear or confusing information. Please tell us more about what you found unclear or confusing, or let us know how we could make it clearer:</p>
<p id="problemLanguageForm" style="display:none">You've told us there is a spelling or grammar error on this page. Please tell us what's wrong:</p>
<p id="problemOtherForm" style="display:none">You've told us this page has a problem. Please tell us more about what's wrong:</p>
<form>
<textarea id="problemFormSuggestionField" cols="40" rows="5"></textarea><input type="hidden" id="problemFormDescription"><input type="submit" id="problemFormDescriptionSubmit" value="Submit">
</form>
</div>
<div id="problemMoreInfoThanks" style="display:none"><p>Thanks for helping to make the Unity documentation better!</p></div>
<script>InitialiseStarRating();</script>
</div>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="PluginsForIOS.html"></a></span><div class="tip">Building Plugins for iOS</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="iosCustomWWWRequest.html"></a></span><div class="tip">Customising WWW requests on iOS</div>
</div>
</div>
</div>
<div class="footer-wrapper"><div class="footer clear">
<div class="copy">Copyright © 2019 Unity Technologies. Publication: 2019.2-003J. Built: 2019-12-16.</div>
<div class="menu">
<a href="https://unity3d.com/learn">Tutorials</a><a href="https://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="https://forum.unity3d.com">Forums</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div></div>
</div>
</div></div>
</div>
</body>
</html>
